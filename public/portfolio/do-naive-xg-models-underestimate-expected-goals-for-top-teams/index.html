<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Do Naive xG Models underestimate Expected Goals for Top Teams?</title>
<meta name="description" content="Describe your website">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/owl.carousel.css">
<link rel="stylesheet" href="/css/owl.theme.css">


  <link href="/css/style.green.css" rel="stylesheet" id="theme-stylesheet">
  <script src="/js/highlight.pack.js"></script> 
  <script>hljs.initHighlightingOnLoad();</script> 
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
    }
  });
  </script>
  <script async type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="/img/favicon.png">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-156024236-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="/">The Significant Game</a></h1>
    
      <p class="sidebar-p">Football and Data.</p>
    
    <ul class="sidebar-menu">
      
        <li><a href="/portfolio/">Home</a></li>
      
        <li><a href="/about/">About</a></li>
      
        <li><a href="/contact/">Get in touch</a></li>
      
    </ul>
    <p class="social">
  
  
  
  <a href="https://twitter.com/thesignigame" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  
  
  <a href="https://github.com/larsmaurath/significant-game" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
        Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="/">The Significant Game</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>Do Naive xG Models underestimate Expected Goals for Top Teams?</h1>
         
<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/pymjs/pym.v1.js"></script>
<script src="/rmarkdown-libs/widgetframe-binding/widgetframe.js"></script>


<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>After <a href="https://www.thesignificantgame.com/portfolio/expected-goals-model-with-tidymodels/" target="_blank">documenting</a> the implementation of a simple xG model I have spent quite a bit of time thinking about what makes a good model and how you could go about quantifying its quality.</p>
<p>A few weeks ago <a href="https://twitter.com/Worville" target="_blank">Tom Worville</a> posted the below chart which sparked a bit of a discussion around the relationship between high shooting output and overperformance of xG.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Look at how clinical Son&#39;s been in terms of scoring above expected (t/t <a href="https://twitter.com/Torvaney?ref_src=twsrc%5Etfw">@Torvaney</a> for the gridline idea here) <a href="https://t.co/1fM5lO7BId">pic.twitter.com/1fM5lO7BId</a></p>&mdash; Tom Worville (@Worville) <a href="https://twitter.com/Worville/status/1332344663605456896?ref_src=twsrc%5Etfw">November 27, 2020</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>My intuition for this phenomenon is that high shooting output is a proxy for the quality of a team and that <em>naive</em> xG models underestimate the xG values for top teams. Given that xG models are by construction unbiased over all teams this also means that they should overestimate xG for poor teams.</p>
<p>In this post I am trying to find evidence for my intuition</p>
</div>
<div id="what-deviation-between-goals-and-xg-is-abnormal" class="section level2">
<h2>What deviation between goals and xG is abnormal?</h2>
<p>Let’s first start with the question of how much variation we should expect between cumulative goals and xG.</p>
<p>Even if we assume that we have a perfect xG model with no estimation error (i.e. the model captures all relevant and repeatable information that influences shot outcome) there will always be residual variance: A shot with true xG of for example 0.5 can only either result in a goal or not. I.e. a Bernoulli distributed random variable with parameter equal to xG can only take values of 1 (goal) or 0 (non-goal).</p>
<p>In contrast to Tom I won’t look at individual players but at xG values for entire teams. That has the advantages of having larger sample sizes, data is easier to come by and we can hopefully answer our initial question of potential bias by team.</p>
<p>Below I am simulating cumulative goal paths generated from the same sequence of cumulative expected goals. Cumulative xG is sampled from a typical xG distribution like the below</p>
<p><img src="/portfolio/2020-12-08-do-naive-xg-models-underestimate-expected-goals-for-top-teams_files/figure-html/Typical%20xG%20distribution-1.png" width="672" /></p>
<p>On the x-axis I show the number of shots from 5 to 1000, on the y-axis cumulative xG/goals. Possible cumulative goal paths are are shown in grey around the red cumulative xG path. The second chart shows the one-sided, relative variation of the 95% confidence interval around cumulative xG.</p>
<p><img src="/portfolio/2020-12-08-do-naive-xg-models-underestimate-expected-goals-for-top-teams_files/figure-html/Animated%20simulation-1.gif" /><!-- --></p>
<p>This simulation provides us with some useful rules of thumb for the natural variation of cumulative goals around the xG metric. Assuming a perfect model without bias and measurement error, cumulative goals will lie within a +/- 20% range around cumulative xG after one season (with 95% confidence). Variation within this range therefore is not necessarily out- or underperformance of xG, but can simply be driven by the natural variation of Bernoulli random variables.</p>
<p>Similar rules are +/- 50% for 10 games and +/- 33% for half a season. Seasonal data is based on an average of 450 shots which may be quite different for top or poor teams: The ranges will be tighter for teams with high shooting output and wider for low shooting teams.</p>
<p>Thanks to the Central Limit Theorem (CLT) we can make this analysis even more useful by deriving an analytic solution that does not rely on simulations. While the law of large numbers tells us that the sample mean will converge towards the expected value of a sequence of random variables, the CLT provides further details about the variability around the expected value given the sample size and the variance of the individual random variables (the larger the sample size and the smaller the variance, the lower the variance all else equal).</p>
<p>Because our sequence of shots, modeled as Bernoulli random variables, all have different parameters (a shot’s xG value) we cannot use the classical CLT which requires independent and identically distributed RVs. Thankfully there is a variation that relaxes the requirement of identical distribution: the Lyapunov CLT.</p>
<p>After checking that the Lyapunov condition holds (it generally does for Bernoulli sequences as long as the limit of the variances is not finite; some more background) <a href="https://math.stackexchange.com/questions/2054592/do-bernoulli-random-variables-always-satisfy-the-lyapunov-condition" target="_blank">here</a> we get that</p>
<p align="center">
<span class="math inline">\(\frac{1}{s_n} \sum_{i=1}^{n} (X_i - \mu_i) {\xrightarrow {d}} N(0,1)\)</span>
</p>
<p>This means that the normalized difference of cumulative goals and cumulative xG converges in distribution to the standard normal distribution. Therefore</p>
<p align="center">
<span class="math inline">\(P(-1.96 &lt; \frac{1}{s_n} \sum_{i=1}^{n} (X_i - \mu_i) &lt; 1.96) \approx P(-1.96 &lt; N(0,1) &lt; 1.96) \approx 0.95\)</span>
</p>
<p>and with a confidence of 95% we have that the difference between cumulative goals and xG lies between</p>
<p align="center">
<span class="math inline">\(P(-1.96s_n &lt; \sum_{i=1}^{n} (X_i - \mu_i) &lt; 1.96s_n)\)</span>
</p>
<p>where <span class="math inline">\(s_n = \sqrt{\sum_{i=1}^{n} \sigma_i^2}\)</span>, the square root of the sum of variance of the individual Bernoulli RVs.</p>
<p>Given that xG distributions are fairly similar across teams, I proxy <span class="math inline">\(\sigma_i^2\)</span> with a random sample of xG data which gives me a value of</p>
<p align="center">
<span class="math inline">\(\sigma_i^2 \approx 0.0878 \approx \frac{1}{12}\)</span>
</p>
<p>We combine this with our above result to a new rule of thumb as a function of our shot sample size</p>
<p align="center">
<span class="math inline">\(P(-1.96 \sqrt{\frac{n}{12}} &lt; \sum_{i=1}^{n} (X_i - \mu_i) &lt; 1.96 \sqrt{\frac{n}{12}})\)</span>
</p>
<p>or approximately</p>
<p align="center">
<span class="math inline">\(P(-\sqrt{\frac{n}{3}} &lt; \sum_{i=1}^{n} (X_i - \mu_i) &lt; \sqrt{\frac{n}{3}})\)</span>
</p>
<p>For an arbitrary number of shots we now know how much deviation to expect (with 95% confidence) between cumulative xG and goals simple driven by the boolean outcome of shots. For example, let’s say that we have xG and goals data for 100 teams based on 300 shots each. We expect that for only 5 teams actual goals deviate from cumulative xG by more than 10 goals (<span class="math inline">\(\sqrt{\frac{300}{3}} = 10\)</span>) in either direction. Again, this assumes no modeling noise (in reality every model is imperfect and will misjudge shots by some degree).</p>
<p>With this rule of thumb we can now investigate how actual xG models compare to this. Deviations from this rule should give us some insights on their modeling errors.</p>
</div>
<div id="comparison-for-statsbomb-and-understat-models" class="section level2">
<h2>Comparison for Statsbomb and Understat models</h2>
<p>I have picked these two xG models because their data is widely available and they represent two levels of sophistication: while Statsbomb adds more proprietary features (like goalkeeper postioning, freeze frames and shot height) my understanding is that Understat is a basic xG model relying on common event data only (shot location, shot type, build up). It will be interesting to see how their behavior differs in the analysis outlined above.</p>
<div id="data" class="section level3">
<h3>Data</h3>
<p>I am pulling xG data for the Top 5 leagues and three seasons (2017/2018, 2018/2019 and 2019/2020) from fbref.com and understat.com. The history is limited by Statsbomb data while the league choice is limited by Understat.</p>
<p>This leaves us with 294 team seasons of data for number of shots, cumulative xG and goals. For around 280 of these seasons we expect cumulative goals to lie in a range of <span class="math inline">\(+/- \sqrt{\dfrac{\#shots}{8}}\)</span> around cumulative xG.</p>
<p>Modeling errors could impact both the cumulative xG estimate for each team season (moving the mid-point of the range) as well as the width of the range which would lead to more goal paths lying outside of the above range. The number of these <em>outliers</em> should give us an indication of the quality of the model. As we look at the performance of both models we will also include a <em>non-model</em> that simply uses the average shot xG (11.5%).</p>
<div id="htmlwidget-1" style="width:100%;height:480px;" class="widgetframe html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"url":"/portfolio/2020-12-08-do-naive-xg-models-underestimate-expected-goals-for-top-teams_files/figure-html//widgets/widget_Summary Statistic.html","options":{"xdomain":"*","allowfullscreen":false,"lazyload":false}},"evals":[],"jsHooks":[]}</script>
<p>We observe that the Statsbomb model behaves much more similar to the perfect model and that a simple model like Understat’s is closer to an even simpler <em>No Model</em>.</p>
<p>Let’s have a look if we can find any bias in the types of teams who’s seasons do not fall in the 95% confidence interval. Only outliers are highlighted below.</p>
<p><img src="/portfolio/2020-12-08-do-naive-xg-models-underestimate-expected-goals-for-top-teams_files/figure-html/Bias%20Shot%20Comb-1.png" width="672" /></p>
</div>
</div>
<div id="sensitivity-to-measure-of-top" class="section level2">
<h2>Sensitivity to measure of “top”</h2>
<p>The number of taken shots over a season is a pretty vague definition of “top team”. To really investigate this relationship let’s look at two other definitions of team quality: elo-rating and team market value. Because we do not want to use a definition that relies on the coincidental performance of a team to the xG data we have, we there use elo ratings in the summer prior to a season’s xG data.</p>
<p><img src="/portfolio/2020-12-08-do-naive-xg-models-underestimate-expected-goals-for-top-teams_files/figure-html/Bias%20Elo%20Comb-1.png" width="672" /></p>
<p>TBA: analysis based on team value</p>
</div>
<div id="intuition" class="section level2">
<h2>Intuition</h2>
<p>We have introduced a measure to roughly quantify the varying quality of xG models. By comparing their behavior in analyzing shots from almost 300 team seasons to a hypothetical, true xG model we find that the more sophisticated Statsbomb model outperforms a simpler model represented by Understat data.</p>
<p>We further investigate if any of the models show a bias in analyzing shots of teams with either high or low shot volume. We find that naive xG models tend to underestimate expected goals for teams with high shot volume and overestimates xG for teams with low hot volume. We do not find this effect for the more sophisticated Statsbomb model that includes additional features like shot freeze frames, goalkeeper positioning and shot height.</p>
<p>This effect may by driven by a systematic underestimation (overestimation) of xG for top (bottom) teams, but when conditioning on other metrics of team quality (elo rank and team value) we do not find this bias in either naive or sophisticated models.</p>
<p>A possible explanation for these observations would be that top teams with higher shot volume are more careful about chosing their shooting opportunities and when in doubt (congested 18 yard box or akward shot height) recycle the ball instead of pulling the trigger.</p>
<p>Along the way we also find some useful rules of thumb to help judge if goals actually significantly outperform cumulative xG or if they are within an interval consistent with the expected variation of Bernoulli random variables of a given sample size.</p>
<ul>
<li><p>For a given cumulative xG value <em>x</em> based on <em>n</em> shots, we expect the resulting goal tally to lie within the interval <span class="math inline">\([x - \sqrt{\frac{n}{3}}, x + \sqrt{\frac{n}{3}}]\)</span>. For a sample size of 300 shots this range is 20 goals wide.</p></li>
<li><p>For a typical team (based on 450 shots of typical shot quality) goals vary 50% around cumulative xG after 10 games, 33% after half a season and 25% after a full season. These values are of course only rough guidelines.</p></li>
</ul>
<p>The above two rules seem to be consistent with David Sumpter’s analysis in <a href="https://soccermatics.medium.com/should-you-write-about-real-goals-or-expected-goals-a-guide-for-journalists-2cf0c7ec6bb6" target="_blank">Should you write about real goals or expected goals?</a>, but I hope to investigate this further at a later point.</p>
</div>

         <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-www-thesignificantgame-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="/js/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/jquery.cookie.js"> </script>
<script src="/js/ekko-lightbox.js"></script>
<script src="/js/jquery.scrollTo.min.js"></script>
<script src="/js/masonry.pkgd.min.js"></script>
<script src="/js/imagesloaded.pkgd.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/front.js"></script>



</body>
</html>
