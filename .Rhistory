throw_in_row$kept_possession <- 1
} else {
throw_in_row$kept_possession <- 0
}
throw_in_scene <- throw_in_scene %>%
filter(teamId == team_id & outcome == "Successful" & type_name == "Pass") %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX), Length = as.numeric(Length))
if(sum(throw_in_scene$accurate_pass) >= 2){
final_pass <- slice(throw_in_scene, nrow(throw_in_scene)) %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX), Length = as.numeric(Length))
end_x <- final_pass$PassEndX*1.05
end_y <- final_pass$PassEndY*0.68
travel_from_throw_in <- sum(throw_in_scene$Length)
if(is.na(travel_from_throw_in)){travel_from_throw_in <- 0}
throw_in_row$travel <- travel_from_throw_in
if(travel_from_throw_in >= 30){
throw_in_row$kept_possession_travel <- 1
} else {
throw_in_row$kept_possession_travel <- 0
}
} else {
throw_in_row$kept_possession_travel <- 0
throw_in_row$travel <- NA
}
df_to_concat[[i]] <- throw_in_row
}
throw_ins_sub_poss <- purrr::reduce(df_to_concat, rbind)
throw_ins_sub_poss <- left_join(throw_ins_sub_poss, matches, by = c("match_id"))
team_ids <- c(26, 37)
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
matches <- tbl(con, "matches") %>%
#filter(season %in% c("2019/2020", "2018/2019", "2017/2018", "2016/2017", "2015/2016", "2014/2015", "2013/2014", "2012/2013")) %>%
filter(season %in% c("2018/2019")) %>%
filter(league %in% c("Champions_League")) %>%
filter(home_team_id %in% team_ids | away_team_id %in% team_ids) %>%
select(c("match_id", "season", "league", "date")) %>%
collect()
DBI::dbDisconnect(con)
match_ids <- matches$match_id
match_summary <- matches %>%
group_by(season, league) %>%
summarise(count = n())
View(matches)
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_ins <- tbl(con, "events") %>%
filter(match_id %in% match_ids) %>%
filter(teamId %in% team_ids) %>%
filter(type_name == "Pass") %>%
filter(qualifiers %like% "%ThrowIn%") %>%
collect()
DBI::dbDisconnect(con)
how_many_seconds <- 7
#throw_ins_sub <- head(throw_ins, 19)
throw_ins_sub <- throw_ins
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
filter(isTouch == 1) %>%
filter(teamId == team_id | (teamId != team_id & outcome == "Successful" & type_name == "Pass")) %>%
collect()
DBI::dbDisconnect(con)
throw_in_row <- slice(throw_ins_sub, i)
start_x <- throw_in_row$location_x*1.05
start_y <- throw_in_row$location_y*0.68
first_three <- head(throw_in_scene, 3) %>%
filter(teamId == team_id & type_name == "Pass")
if(nrow(first_three) == 3 & (first_three[1, ]$playerId == first_three[3, ]$playerId)){
throw_in_row$layoff <- 1
} else{
throw_in_row$layoff <- 0
}
# two definitions: either team kept possession for full 5 seconds or team has possession at the end of 5 seconds
throw_in_scene <- throw_in_scene %>%
mutate(accurate_pass = if_else(outcome == "Successful" & type_name == "Pass", 1, 0))
if((length(unique(throw_in_scene$teamId)) == 1 & sum(throw_in_scene$accurate_pass) >= 2 )| 1 %in% throw_in_scene$isShot){
throw_in_row$kept_possession <- 1
} else {
throw_in_row$kept_possession <- 0
}
throw_in_scene <- throw_in_scene %>%
filter(teamId == team_id & outcome == "Successful" & type_name == "Pass") %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX), Length = as.numeric(Length))
if(sum(throw_in_scene$accurate_pass) >= 2){
final_pass <- slice(throw_in_scene, nrow(throw_in_scene)) %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX), Length = as.numeric(Length))
end_x <- final_pass$PassEndX*1.05
end_y <- final_pass$PassEndY*0.68
travel_from_throw_in <- sum(throw_in_scene$Length)
if(is.na(travel_from_throw_in)){travel_from_throw_in <- 0}
throw_in_row$travel <- travel_from_throw_in
if(travel_from_throw_in >= 30){
throw_in_row$kept_possession_travel <- 1
} else {
throw_in_row$kept_possession_travel <- 0
}
} else {
throw_in_row$kept_possession_travel <- 0
throw_in_row$travel <- NA
}
df_to_concat[[i]] <- throw_in_row
}
throw_ins_sub_poss <- purrr::reduce(df_to_concat, rbind)
throw_ins_sub_poss <- left_join(throw_ins_sub_poss, matches, by = c("match_id"))
View(throw_ins_sub_poss)
throw_ins_sub_poss_q <- throw_ins_sub_poss %>%
mutate(tercile = ceiling(location_x/33))
kept_possession <- throw_ins_sub_poss_q %>%
#group_by(season, league, teamId) %>%
group_by(match_id, teamId) %>%
summarize(kept_possession = mean(kept_possession), kept_possession_travel = mean(kept_possession_travel), layoff = mean(layoff))
View(kept_possession)
throw_ins_sub_poss_q <- throw_ins_sub_poss %>%
mutate(tercile = ceiling(location_x/33))
kept_possession <- throw_ins_sub_poss_q %>%
group_by(season, league, teamId) %>%
summarize(kept_possession = mean(kept_possession), kept_possession_travel = mean(kept_possession_travel), layoff = mean(layoff))
View(kept_possession)
throw_ins_sub_poss_q <- throw_ins_sub_poss %>%
mutate(tercile = ceiling(location_x/33))
kept_possession <- throw_ins_sub_poss_q %>%
group_by(season, league, teamId, tercile) %>%
summarize(kept_possession = mean(kept_possession), kept_possession_travel = mean(kept_possession_travel), layoff = mean(layoff))
View(kept_possession)
angles <- throw_ins_sub_poss %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX)) %>%
mutate(angle = atan2(abs(PassEndY - location_y), PassEndX - location_x)*180/pi) %>%
select(event_id, teamId, tercile, location_x, location_y, PassEndX, PassEndY, angle, kept_possession) %>%
mutate(angle_class = if_else(angle <= 60, "Forward", if_else(angle <= 120, "Straight", "Backward"))) %>%
group_by(teamId, tercile, angle_class) %>%
summarise(n = n(), kept = mean(kept_possession)) %>%
mutate(freq = n / sum(n))
angles <- throw_ins_sub_poss_q %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX)) %>%
mutate(angle = atan2(abs(PassEndY - location_y), PassEndX - location_x)*180/pi) %>%
select(event_id, teamId, tercile, location_x, location_y, PassEndX, PassEndY, angle, kept_possession) %>%
mutate(angle_class = if_else(angle <= 60, "Forward", if_else(angle <= 120, "Straight", "Backward"))) %>%
group_by(teamId, tercile, angle_class) %>%
summarise(n = n(), kept = mean(kept_possession)) %>%
mutate(freq = n / sum(n))
View(angles)
matches <- tbl(con, "matches") %>%
#filter(season %in% c("2019/2020", "2018/2019", "2017/2018", "2016/2017", "2015/2016", "2014/2015", "2013/2014", "2012/2013")) %>%
filter(season %in% c("2018/2019")) %>%
filter(league %in% c("Champions_League"))
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
matches <- tbl(con, "matches") %>%
#filter(season %in% c("2019/2020", "2018/2019", "2017/2018", "2016/2017", "2015/2016", "2014/2015", "2013/2014", "2012/2013")) %>%
filter(season %in% c("2018/2019")) %>%
filter(league %in% c("Champions_League"))
matches <- tbl(con, "matches") %>%
#filter(season %in% c("2019/2020", "2018/2019", "2017/2018", "2016/2017", "2015/2016", "2014/2015", "2013/2014", "2012/2013")) %>%
filter(season %in% c("2018/2019")) %>%
filter(league %in% c("Champions_League")) %>%
#filter(home_team_id %in% team_ids | away_team_id %in% team_ids) %>%
select(c("match_id", "season", "league", "date")) %>%
collect()
View(matches)
team_ids <- c(26, 37)
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
matches <- tbl(con, "matches") %>%
#filter(season %in% c("2019/2020", "2018/2019", "2017/2018", "2016/2017", "2015/2016", "2014/2015", "2013/2014", "2012/2013")) %>%
filter(season %in% c("2018/2019")) %>%
filter(league %in% c("Champions_League")) %>%
filter(home_team_id %in% team_ids | away_team_id %in% team_ids) %>%
select(c("match_id", "season", "league", "date")) %>%
collect()
DBI::dbDisconnect(con)
match_ids <- matches$match_id
match_summary <- matches %>%
group_by(season, league) %>%
summarise(count = n())
View(matches)
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_ins <- tbl(con, "events") %>%
filter(match_id %in% match_ids) %>%
filter(teamId %in% team_ids) %>%
filter(type_name == "Pass") %>%
filter(qualifiers %like% "%ThrowIn%") %>%
collect()
DBI::dbDisconnect(con)
how_many_seconds <- 7
#throw_ins_sub <- head(throw_ins, 19)
throw_ins_sub <- throw_ins
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
filter(isTouch == 1) %>%
filter(teamId == team_id | (teamId != team_id & outcome == "Successful" & type_name == "Pass")) %>%
collect()
DBI::dbDisconnect(con)
throw_in_row <- slice(throw_ins_sub, i)
start_x <- throw_in_row$location_x*1.05
start_y <- throw_in_row$location_y*0.68
first_three <- head(throw_in_scene, 3) %>%
filter(teamId == team_id & type_name == "Pass")
if(nrow(first_three) == 3 & (first_three[1, ]$playerId == first_three[3, ]$playerId)){
throw_in_row$layoff <- 1
} else{
throw_in_row$layoff <- 0
}
# two definitions: either team kept possession for full 5 seconds or team has possession at the end of 5 seconds
throw_in_scene <- throw_in_scene %>%
mutate(accurate_pass = if_else(outcome == "Successful" & type_name == "Pass", 1, 0))
if((length(unique(throw_in_scene$teamId)) == 1 & sum(throw_in_scene$accurate_pass) >= 2 )| 1 %in% throw_in_scene$isShot){
throw_in_row$kept_possession <- 1
} else {
throw_in_row$kept_possession <- 0
}
throw_in_scene <- throw_in_scene %>%
filter(teamId == team_id & outcome == "Successful" & type_name == "Pass") %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX), Length = as.numeric(Length))
if(sum(throw_in_scene$accurate_pass) >= 2){
final_pass <- slice(throw_in_scene, nrow(throw_in_scene)) %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX), Length = as.numeric(Length))
end_x <- final_pass$PassEndX*1.05
end_y <- final_pass$PassEndY*0.68
travel_from_throw_in <- sum(throw_in_scene$Length)
if(is.na(travel_from_throw_in)){travel_from_throw_in <- 0}
throw_in_row$travel <- travel_from_throw_in
if(travel_from_throw_in >= 30){
throw_in_row$kept_possession_travel <- 1
} else {
throw_in_row$kept_possession_travel <- 0
}
} else {
throw_in_row$kept_possession_travel <- 0
throw_in_row$travel <- NA
}
df_to_concat[[i]] <- throw_in_row
}
throw_ins_sub_poss <- purrr::reduce(df_to_concat, rbind)
throw_ins_sub_poss <- left_join(throw_ins_sub_poss, matches, by = c("match_id"))
throw_ins_sub_poss_q <- throw_ins_sub_poss %>%
mutate(tercile = ceiling(location_x/33))
kept_possession <- throw_ins_sub_poss_q %>%
group_by(season, league, teamId, tercile) %>%
summarize(kept_possession = mean(kept_possession), kept_possession_travel = mean(kept_possession_travel), layoff = mean(layoff))
View(kept_possession)
angles <- throw_ins_sub_poss_q %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX)) %>%
mutate(angle = atan2(abs(PassEndY - location_y), PassEndX - location_x)*180/pi) %>%
select(event_id, teamId, tercile, location_x, location_y, PassEndX, PassEndY, angle, kept_possession) %>%
mutate(angle_class = if_else(angle <= 60, "Forward", if_else(angle <= 120, "Straight", "Backward"))) %>%
group_by(teamId, tercile, angle_class) %>%
summarise(n = n(), kept = mean(kept_possession)) %>%
mutate(freq = n / sum(n))
View(angles)
team_ids <- c(26, 37)
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
matches <- tbl(con, "matches") %>%
#filter(season %in% c("2019/2020", "2018/2019", "2017/2018", "2016/2017", "2015/2016", "2014/2015", "2013/2014", "2012/2013")) %>%
filter(season %in% c("2019/2020", "2018/2019", "2017/2018", "2016/2017")) %>%
filter(league %in% c("Champions_League")) %>%
filter(home_team_id %in% team_ids | away_team_id %in% team_ids) %>%
select(c("match_id", "season", "league", "date")) %>%
collect()
DBI::dbDisconnect(con)
match_ids <- matches$match_id
match_summary <- matches %>%
group_by(season, league) %>%
summarise(count = n())
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_ins <- tbl(con, "events") %>%
filter(match_id %in% match_ids) %>%
filter(teamId %in% team_ids) %>%
filter(type_name == "Pass") %>%
filter(qualifiers %like% "%ThrowIn%") %>%
collect()
DBI::dbDisconnect(con)
how_many_seconds <- 7
#throw_ins_sub <- head(throw_ins, 19)
throw_ins_sub <- throw_ins
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
filter(isTouch == 1) %>%
filter(teamId == team_id | (teamId != team_id & outcome == "Successful" & type_name == "Pass")) %>%
collect()
DBI::dbDisconnect(con)
throw_in_row <- slice(throw_ins_sub, i)
start_x <- throw_in_row$location_x*1.05
start_y <- throw_in_row$location_y*0.68
first_three <- head(throw_in_scene, 3) %>%
filter(teamId == team_id & type_name == "Pass")
if(nrow(first_three) == 3 & (first_three[1, ]$playerId == first_three[3, ]$playerId)){
throw_in_row$layoff <- 1
} else{
throw_in_row$layoff <- 0
}
# two definitions: either team kept possession for full 5 seconds or team has possession at the end of 5 seconds
throw_in_scene <- throw_in_scene %>%
mutate(accurate_pass = if_else(outcome == "Successful" & type_name == "Pass", 1, 0))
if((length(unique(throw_in_scene$teamId)) == 1 & sum(throw_in_scene$accurate_pass) >= 2 )| 1 %in% throw_in_scene$isShot){
throw_in_row$kept_possession <- 1
} else {
throw_in_row$kept_possession <- 0
}
throw_in_scene <- throw_in_scene %>%
filter(teamId == team_id & outcome == "Successful" & type_name == "Pass") %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX), Length = as.numeric(Length))
if(sum(throw_in_scene$accurate_pass) >= 2){
final_pass <- slice(throw_in_scene, nrow(throw_in_scene)) %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX), Length = as.numeric(Length))
end_x <- final_pass$PassEndX*1.05
end_y <- final_pass$PassEndY*0.68
travel_from_throw_in <- sum(throw_in_scene$Length)
if(is.na(travel_from_throw_in)){travel_from_throw_in <- 0}
throw_in_row$travel <- travel_from_throw_in
if(travel_from_throw_in >= 30){
throw_in_row$kept_possession_travel <- 1
} else {
throw_in_row$kept_possession_travel <- 0
}
} else {
throw_in_row$kept_possession_travel <- 0
throw_in_row$travel <- NA
}
df_to_concat[[i]] <- throw_in_row
}
throw_ins_sub_poss <- purrr::reduce(df_to_concat, rbind)
throw_ins_sub_poss <- left_join(throw_ins_sub_poss, matches, by = c("match_id"))
throw_ins_sub_poss_q <- throw_ins_sub_poss %>%
mutate(tercile = ceiling(location_x/33))
kept_possession <- throw_ins_sub_poss_q %>%
group_by(season, league, teamId, tercile) %>%
summarize(kept_possession = mean(kept_possession), kept_possession_travel = mean(kept_possession_travel), layoff = mean(layoff))
angles <- throw_ins_sub_poss_q %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX)) %>%
mutate(angle = atan2(abs(PassEndY - location_y), PassEndX - location_x)*180/pi) %>%
select(event_id, teamId, tercile, location_x, location_y, PassEndX, PassEndY, angle, kept_possession) %>%
mutate(angle_class = if_else(angle <= 60, "Forward", if_else(angle <= 120, "Straight", "Backward"))) %>%
group_by(teamId, tercile, angle_class) %>%
summarise(n = n(), kept = mean(kept_possession)) %>%
mutate(freq = n / sum(n))
View(angles)
View(kept_possession)
View(throw_in_scene)
View(angles)
angles <- throw_ins_sub_poss_q %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX)) %>%
mutate(angle = atan2(abs(PassEndY - location_y), PassEndX - location_x)*180/pi) %>%
select(event_id, teamId, tercile, location_x, location_y, PassEndX, PassEndY, angle, kept_possession) %>%
mutate(angle_class = if_else(angle <= 60, "Forward", if_else(angle <= 120, "Straight", "Backward"))) %>%
group_by(season, teamId, tercile, angle_class) %>%
summarise(n = n(), kept = mean(kept_possession)) %>%
mutate(freq = n / sum(n))
angles <- throw_ins_sub_poss_q %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX)) %>%
mutate(angle = atan2(abs(PassEndY - location_y), PassEndX - location_x)*180/pi) %>%
select(event_id, season, teamId, tercile, location_x, location_y, PassEndX, PassEndY, angle, kept_possession) %>%
mutate(angle_class = if_else(angle <= 60, "Forward", if_else(angle <= 120, "Straight", "Backward"))) %>%
group_by(season, teamId, tercile, angle_class) %>%
summarise(n = n(), kept = mean(kept_possession)) %>%
mutate(freq = n / sum(n))
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
match_ids <- c("1343409")
throw_ins <- tbl(con, "events") %>%
filter(match_id %in% match_ids) %>%
filter(teamId %in% team_ids) %>%
filter(type_name == "Pass") %>%
filter(qualifiers %like% "%ThrowIn%") %>%
collect()
DBI::dbDisconnect(con)
how_many_seconds <- 7
throw_ins_sub <- head(throw_ins, 1)
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
collect()
DBI::dbDisconnect(con)
}
View(throw_in_scene)
how_many_seconds <- 7
throw_ins_sub <- head(throw_ins, 2)
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
collect()
DBI::dbDisconnect(con)
}
how_many_seconds <- 7
throw_ins_sub <- head(throw_ins, 4)
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
collect()
DBI::dbDisconnect(con)
}
how_many_seconds <- 7
throw_ins_sub <- head(throw_ins, 5)
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
collect()
DBI::dbDisconnect(con)
}
how_many_seconds <- 7
throw_ins_sub <- head(throw_ins, 6)
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
collect()
DBI::dbDisconnect(con)
}
how_many_seconds <- 7
throw_ins_sub <- head(throw_ins, 7)
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
collect()
DBI::dbDisconnect(con)
}
throw_ins_sub <- head(throw_ins, 8)
how_many_seconds <- 7
throw_ins_sub <- head(throw_ins, 8)
df_to_concat <- list()
for(i in 1:nrow(throw_ins_sub))
{
match_id_filter <- throw_ins_sub$match_id[[i]]
start_time <- throw_ins_sub$minute[[i]]*60 + throw_ins_sub$second[[i]]
end_time <- start_time + how_many_seconds
team_id <- throw_ins_sub$teamId[[i]]
con <- DBI::dbConnect(RSQLite::SQLite(), dbname = "~/Documents/Blog/Data/data.sqlite")
throw_in_scene <- tbl(con, "events") %>%
filter(match_id == match_id_filter) %>%
filter(between(minute*60 + second, start_time, end_time)) %>%
collect()
DBI::dbDisconnect(con)
}
View(throw_in_scene)
angles <- throw_ins_sub_poss_q %>%
mutate(PassEndY = as.numeric(PassEndY), PassEndX = as.numeric(PassEndX)) %>%
mutate(angle = atan2(abs(PassEndY - location_y), PassEndX - location_x)*180/pi) %>%
select(event_id, season, teamId, tercile, location_x, location_y, PassEndX, PassEndY, angle, kept_possession) %>%
mutate(angle_class = if_else(angle <= 60, "Forward", if_else(angle <= 120, "Straight", "Backward"))) %>%
filter(angle_class != "Backward") %>%
group_by(season, teamId, tercile) %>%
summarise(n = n(), kept = mean(kept_possession)) %>%
mutate(freq = n / sum(n))
View(angles)
